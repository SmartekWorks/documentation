Web应用
===

系统操作中的Web应用组件，可以提供跨平台的操作各类Web应用的功能。

### Web元素的选择器

通过指定Web元素的选择器，可以定位Web网页上的各类交互控件，比如按钮、文本输入框、下拉选择框等等。我们推荐使用[SWATHub Browser Extension](../manual/robot_web_inspector)浏览器插件来获取Web元素的选择器。

Web元素的选择器通过一个JSON对象，其属性包括如下：
* `frame`：如果当前页面元素位于某个frame中，则需要通过一个JSON对象来定义该frame，包括如下属性：
  * `name`：frame的name属性。
  * `id`：frame的id属性。
  * `css`：可以在frame的父辈网页中定位的CSS选择器。
  * `handle`：自定义的frame序列号，通过`-`分割的数字组合来定义。比如`1-3`，代表首先定位到根网页下的第一个子frame，然后定位到该frame下的第三个子frame。
* `id`: 元素的id属性。
* `name`：元素的name属性。
* `css`：定位该元素的CSS选择器。
* `text`：通过文本来过滤多个符合上述条件的元素。
* `index`：通过序列号来过滤多个符合上述条件的元素。从`1`开始。

选择器的例子：
```json
{
  "frame": {
    "name": "mainFrame"
  },
  "css": "button.ui-button-success",
  "text": "Submit"
}
```

点击元素
---

对于Web页面上的某个画面元素，进行点击操作，支持鼠标左键或右键，单击或双击的组合操作。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 选择器  | 目标元素的[Web选择器](#Web元素的选择器)。
| 按钮  | 点击的鼠标按钮，使用`left`或者`right`。
| 类型  | 点击的类型，使用`single`或者`double`。

#### 输出结果

无

悬停元素
---

对于Web页面上的某个画面元素，进行鼠标悬停操作。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 选择器  | 目标元素的[Web选择器](#Web元素的选择器)。

#### 输出结果

无

选择下拉选项
---

对于Web页面上的Select下拉选择框，进行单选或多选操作。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 选择器  | 目标元素的[Web选择器](#Web元素的选择器)。
| 选项  | 通过逗号分隔的选项，支持文本或者序号（从`1`开始）两种方式。比如，`car,bike,ship`表示同时选中这三项，而`1,3`表示同时选中第一和第三项。
| 模式  | 定义选项的模式，支持`text`和`index`两种。

#### 输出结果

无

输入文本
---

对于Web页面上的文本框，进行输入文本操作。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 选择器  | 目标元素的[Web选择器](#Web元素的选择器)。
| 文本  | 输入的文本，可以使用特殊键值，如`#{TAB}`，`#{UP}`，`#{ENTER}`等。

#### 输出结果

无

拖放元素
---

对于Web页面上的某个画面元素，进行鼠标拖放操作。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 选择器 | 目标元素的[Web选择器](#Web元素的选择器)。
| 偏移值 | JSON数组表示的拖放偏移值，如`[100,0]`表示向右拖放100个像素点的位移。

#### 输出结果

无

存在元素
---

对于Web页面上的某个画面元素，检查其是否存在。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 选择器 | 目标元素的[Web选择器](#Web元素的选择器)。
| 变量名 | （可选）保存检查结果的变量名，结果为`true`或`false`。

#### 输出结果

无

Web等待
---

在当前浏览器的Session和窗口中等待指定时间或指定条件的满足<sup>1</sup>。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 等待时间（秒） | 需要等待的秒数。
| 满足条件 | 需要等待满足的条件，<br>使用[匹配规则](rule_matching)。如果不指定时使用`[]`。

#### 输出结果

无

?> 1. 等待时间和满足条件同时指定时，本操作将会在等待时间范围内等待条件的满足。如果到等待时间条件仍然没有满足，等待也会结束。

Web验证
---

判断当前窗口中的页面是否符合预先设置的条件。如果满足，则该步骤正常结束，执行之后的步骤。如果不满足，则会发生验证错误，并抛出错误。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 匹配规则 | 用来判断是否符合条件的规则，使用[匹配规则](rule_matching)。如果不指定时使用`[]`。

#### 输出结果

无

网页数据抓取
---

在浏览器的当前窗口中抓取复杂数据。

#### 输入参数

| 参数 | 说明
| ---- | ----
| 规则 | 寻找复杂数据的规则，使用如下的格式。

获取规则是包含以下键值的JSON Map。我们推荐使用[SWATHub Browser Extension](../manual/robot_web_inspector)浏览器插件来获取抓取规则。

* `frame`（可选）：目标frame的定义，通过一个JSON对象来定义该frame，包括如下属性：
  * `name`：frame的name属性。
  * `id`：frame的id属性。
  * `css`：可以在frame的父辈网页中定位的CSS选择器。
  * `handle`：自定义的frame序列号，通过`-`分割的数字组合来定义。比如`1-3`，代表首先定位到根网页下的第一个子frame，然后定位到该frame下的第三个子frame。
* `opts`: 基于[scrape-it](https://github.com/IonicaBizau/scrape-it#params-1)的规则，其不但定义了所需要获取的数据，也定义了输出的格式。

以下是获取规则的例子。

```json
{
  "frame": {
    "name": "content_iframe",
  },
  "opts": {
    "input_value": {
      "selector": "input[name=input_enable]",
      "attr": "value"
    },
    "link_href": {
      "selector": "#link",
      "attr": "href"
    }
  }
}
```

#### 输出结果

按照[scrape-it](https://github.com/IonicaBizau/scrape-it#params-1)规则生成的JSON对象格式的返回值。