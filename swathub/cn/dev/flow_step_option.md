运行设置
===

在步骤的运行中，可以通过步骤的运行设置，对操作进行行为的调整来适应各式各样的用户应用环境。其可以通过以下几种方式来设置。

* 对于某个操作的步骤进行单独设置。
* 通过设置某个流程的步骤，对该流程中所有的步骤进行设置。
* 通过调试或测试时的场景组设置，或实际运用时的场景配置的方式，对整个场景中所有的步骤进行设置。

运行设置形式上是一个JSON的Map，由若干对属性和设置组成。当前SWATHub支持以下几类设置：

* [流程控制](#流程控制)
* [浏览器设置](#浏览器设置)
* [浏览器动作](#浏览器动作)
* [GUI和移动设置](#GUI和移动设置)
* [测试功能](#测试功能)

流程控制
---

#### `ignoreError`

当步骤的运行中发生错误时，是否忽略错误继续运行。

* 有如下几种设置值。缺省值为`none`。
  * `none`：步骤发生错误时，结束本流程运行，运行结果标记为错误。
  * `ignore`：步骤发生错误时，流程继续运行，无论后续运行成功与否，运行结果标记为错误。
  * `silentIgnore`：步骤发生错误时，流程继续运行，不标记运行结果。
* `ignoreError`的优先级高于验证的优先级，所以当同时设置了和验证相关属性，或用在验证类型的操作时，验证出错处理的方式将被忽视。

#### `commandInterval`

步骤的操作中的每个动作（比方说输入表单时的每一项输入动作）之间的人为等待间隔。

* 单位为毫秒。
* 使用非负整数，缺省值为`0`。

#### `operationInterval`

步骤的操作后的人为等待间隔。

* 单位为毫秒。
* 使用非负整数，缺省值为`0`。

#### `recursiveCallDepth`

调用流程时的最大深度，当场景调用一个子流程时，深度为`1`，这个子流程再调用一个子流程时，深度为`2`。这项设置主要用在控制递归调用流程时的深度。

* 使用非负整数，缺省值为`3`。
* `recursiveCallDepth`的设置仅对场景有效。

#### `stepBypass`

是否激活当前步骤的[步骤忽略](flow_control#步骤忽略)机制，缺省为`true`。

#### `stepValidate`

是否校验当前步骤的输入参数，缺省为`true`。

浏览器设置
---

#### `browserTimeout`

浏览器组件的超时时间。

* 单位为秒。
* 使用正整数，缺省值为`30`。
* 本项设置需要在浏览器启动的步骤，或者整个流程上进行设置。

#### `browserWidth`

浏览器宽度的初始值。

* 使用`100`至`2000`之间的整数，缺省值为`1280`。
* 本项设置需要在浏览器启动的步骤，或者整个流程上进行设置。

#### `browserHeight`

浏览器高度的初始值。

* 使用`100`至`2000`之间的整数，缺省值为`800`。
* 本项设置需要在浏览器启动的步骤，或者整个流程上进行设置。

#### `browserMaximize`

浏览器最大化。

* 使用`true`或`false`，缺省值为`false`。
* 最大化时，`browserWidth`和`browserHeight`的设置值将无效。
* 本项设置需要在浏览器启动的步骤，或者整个流程上进行设置。

#### `browserDownloadDir`

浏览器下载目录。

* 使用字符串，缺省值为空串。
* 优先级高于机器人设置中的下载目录。
* 本项设置需要在浏览器启动的步骤，或者整个流程上进行设置。

#### `browserCapabilities`

增加Web Driver的Capabilities。

* 使用Capabilities的MAP来设置选项和值，缺省值为`{}`。
* 本项设置需要在浏览器启动的步骤，或者整个流程上进行设置。

#### `browserEmulations`

使用Javascript或UI自动化方式来代替Web Driver来操作浏览器。在Web Driver无效时使用。

* 使用MAP的数组，每个MAP有如下几种设置选项。缺省值为`[]`。
  * `browser`：浏览器名称，目前支持`IE`、`Firefox`、`Chrome`、`Safari`、`Edge`和`Edge Legacy`。必填项。
  * `oss` ：操作系统的数组。不设置时，即为所有操作系统。
  * `versions`：浏览器版本的数组。不设置时，即为所有版本。
  * `actions`：模拟操作的数组。目前有`click`、`check`、`select`和`type`。不设置时，即为不模拟这些操作。
  * `mode`：模拟操作的触发时机。下列值至少设置一个。
    * `all`：平台和操作一致时触发。
    * `error`：错误时触发。例如，需要操作页面元素被隐藏，导致Web Driver操作发生错误时。
    * `none`：不进行模拟。
  * `axis`：设置操作对象的[Relative xpath](https://developer.mozilla.org/en-US/docs/Web/XPath/Axes)。设置后、将使用设置的交互操作来代替原来的模拟操作。

#### `chromeOptions`

Chrome的额外设置。

* 使用MAP来设置选项和值，缺省值为`{}`。
* 设置选项可以参考[这里](https://sites.google.com/a/chromium.org/chromedriver/capabilities)，一般常用的有：
  * `mobileEmulation`：**deviceName**的值、或者**deviceMetrics**、 **userAgent**的值的MAP。**deviceName**必须在DevTool模拟列表中存在设备中选择。例如，`{"mobileEmulation":{"deviceName":"Google Nexus 5"}}`
* 本项设置需要在浏览器启动的步骤，或者整个流程上进行设置。

#### `ieOptions`

Internet Explorer的特殊设置。

* 使用MAP来设置选项和值，有如下几种设置选项，缺省值为`{}`。
  * `scriptClick`：使用Javascript的click()来代替Web Driver模拟点击操作。值是IE版本的数组（使用`,`分隔）。例如，`"7,9,11"`代表IE 7、9、11的版本使用该功能。缺省值为空白。
  * `scriptType`：使用Javascript的功能来模拟对输入框的操作，包括获得焦点，输入，事件触发和移除焦点。 `#{ENTER}`之类的按键动作将被无视。 值是IE版本的字符串（使用`,`分隔）。不支持 IE 8 和更低的版本。 缺省值为空白。
  * `textCheck`：在输入文字后，检验是否正确输入。错误时，将再次输入。值是IE版本的数组（使用`,`分隔）。例如，`"7,9,11"`代表IE 7、9、11的版本使用该功能。缺省值为空白。
  * `textMax`：在输入文字时，将需要输入的文字按`textMax`的数值的长度分几次输入。使用非负整数。设置0代表不分割。缺省值为`0`。

#### `edgeOptions`

Edge的特殊设置。

* 使用MAP来设置选项和值，有如下几种设置选项，缺省值为`{}`。
  * `basicAuthTimeout`：Basic认证对话框按确定的功能。设定值是对话框出现之前的等待时间。单位为秒。使用非负整数。设置0代表不使用该功能。缺省值为`0`。

#### `browserScreenshot`
浏览器截屏的设置。

* 使用MAP来设置选项和值，有如下几种设置选项，缺省值为`{}`。
  * `fullscreen `：选择桌面截图还是浏览器截图的选项，使用`true`或`false`。缺省值为`false`。
  * `fullscreenScroll`：在有可以滚屏的窗口时，是否要滚动截取多张截图的选项，仅当`fullscreen`被设置为`true`有效。使用`true`或`false`。缺省值为`false`。
  * `scrollableFrames`：需要滚屏截图的窗体。设定值是窗体 (包含下列内容的MAP) 的数组。缺省值为`[]`。
    * `id`：窗体的ID。例如，`{"id":"frame2"}`。
    * `name`：窗体的名称。例如，`{"name":"frame2"}`。
  * `scrollableElements`：需要滚屏截图的元素。设定值是元素 (包含下列内容的MAP) 的数组。缺省值为`[]`。
    * `id`：元素的ID。例如，`{"id":"shopping_cart"}`。
    * `css`：元素的CSS选择器(IE9+)。例如，`{"css":"div.main_menu"}`。
    * `frame`:元素所在的窗体(设定值是窗体 (包含下列内容的JSON对象) 的数组)。
        * `id`：窗体的ID。例如，`{"id":"frame2"}`。
        * `name`：窗体的名称。例如，`{"name":"frame2"}`。
  * `scrollOffset`：在对存在顶部浮动栏的页面进行滚屏截图时、可以修正滚屏距离。设定值非0时、每个截图将不会被合成一张全屏截图。使用整数。缺省值为`0`。

#### `browserScrollIntoView`

在操作画面元素前，先滚动到该元素的可见位置。

* 有如下几种设置值。缺省值为`none`。
  * `none`：不滚动。
  * `top`：滚动到画面元素在顶部显示的位置。
  * `bottom`：滚动到画面元素在底部显示的位置。
  * `middle`：滚动到画面元素在中间显示的位置。
* 在有些浏览器无法操作没有显示的元素时，可以使用该功能。

#### `browserFrameDepth`

操作窗体的最大层数。

* 使用非负整数，缺省值为`3`。

#### `browserPageRefresh`

步骤执行后，是否要刷新画面。

* 使用`true`或者`false`。缺省值为`true`。
* 画面不会发生变化时，可以设置为`false`来提升执行效率。

#### `browserFindByCSS`

操作画面元素时，是否使用CSS属性来代替xPath。

* 使用`true`或者`false`。缺省值为`false`。
* 该选项常用于IE中出现的HTML语法错误。

#### `browserKeepSession`

执行完毕之后是否保留浏览器会话不关闭。仅在系统操作`访问URL`中设置有效。

* 使用`true`或者`false`。缺省值为`false`。

浏览器动作
---

#### `browserAlert`

设置如何处理浏览器弹出的警告对话框。预料之外的警告对话框常常是流程执行失败的原因，因此在会产生警告对话框的步骤中需要设置此项目。

* 使用MAP来设置选项和值，有如下几种设置选项，缺省值为`{}`，即为不处理。
  * `action`：设置对警告对话框的操作方式。可以选择`accept`、`dismiss`、`ignore`。缺省值为`accept`。
  * `timeout`：设置等待警告对话框出现的时间。单位为秒。缺省值为`5`。
  * `times`：设置连续处理警告对话框的次数。缺省值为`1`。
  * `screenshot`：设置警告对话框出现时是否截图。缺省值为`false`。

#### `browserDownload`

设置如何处理浏览器下载。

* 使用MAP来设置选项和值，有如下几种设置选项，缺省值为`{}`，即为不处理。
  * `promptTimeout`：设置当前操作结束后至下载操作（下载对话框等）开始之间的等待时间。因为Firefox和Chrome是自动下载的关系，该设定仅对**Internet Explorer**有效。单位为秒。缺省值为`5`。
  * `completeTimeout`:设置下载文件的时间。下载完成后，下载文件也将被作为该步骤的验证结果。单位为秒。缺省值为`30`。
* 上传和下载动作在实际执行中因为操作系统的原因，可能会发生不稳定的情况。
* 机器人需要手动设置下载路径，才能获取下载文件。
* 一般来说，通过浏览器将文件下载到本地之前，会有对确认对话框进行确认或取消的操作。为了不显示确认对话框，让文件自动下载、需要按下述方法对不同的浏览器进行设置。
  * **Chrome**和**Firefox** 机器人会按照设置的下载路径自行设定无需其他的手工设置。
  * **Internet Explorer** 需要将**默认下载路径**手动设置为机器人的下载路径。可以通过浏览器的**工具 > 查看下载 > 选项**来改变下载路径。
  * **Microsoft Edge** 为了自动下载需要调整设置。步骤如下：通过**设置 > 常规 > 每次下载都询问我该做什么**，选择`关`。选择保存位置为机器人的下载路径。
  * **Safari** 需要将**默认下载路径**手动设置为机器人的下载路径。缺省下载完成后会打开文件。要将这个操作取消，则需将**偏好设置 > 通用 > 下载后打开“安全的”文件**的勾去除。

各类APP设置
---

#### `winappTimeout`

定位Windows APP中控件的超时时间。

* 单位为秒。
* 使用正整数，缺省值为`15`。

#### `guiTimeout`

定位GUI元素的超时时间。

* 单位为秒。
* 使用正整数，缺省值为`15`。

#### `mobileTimeout`

定位移动元素的超时时间。

* 单位为秒。
* 使用正整数，缺省值为`30`。


#### `mobileTextClear`

是否在输入之前清除现有的文本。

* 使用`true`或者`false`。缺省值为`true`。
* 当操作类似日期选择的下拉控件时，一般需要设置为`false`。

#### `mobileScrollIntoView`

是否将元素滚动至可见，再进行操作。

* 使用`true`或者`false`。缺省值为`false`。
* 本选项仅适用于Native APP，因为不在显示范围内的元素可能不会出现在页面的Layout XML中，从而无法被找到。
* Hybrid APP的WebView中的元素，已经出现在页面的HTML中，如需先滚动至可见再操作，须使用`browserScrollIntoView`。

#### `mobileKeepSession`

执行完毕之后是否保留APP会话不关闭。仅在系统操作`启动App`中设置有效。

* 使用`true`或者`false`。缺省值为`false`。

#### `apiOptions`

应用于API操作的特殊设置。

* 使用MAP来设置选项和值，有如下几种设置选项，缺省值为`{}`。
  * `useSystemProxy`：是否使用机器人设置中的代理设定。缺省值为`false`。
  * `rejectUnauthorized`: 是否拒绝未经认证的证书。缺省值为`false`。

测试功能
---

#### `evidenceLevel`

获取检证物的不同等级。

* 有如下几种设置值，测试和调试时缺省为`2`，发布运行时缺省为`0`。
  * `0`：仅仅保存执行错误的步骤的HTML代码和截图。
  * `1`：保存使用ASSERT组件或执行错误的步骤的HTML代码和截图。
  * `2`：保存所有步骤的HTML代码和截图。
  * `3`: 仅保存所有步骤的截图。

#### `stepDiff`

步骤的检证物和基准结果比较的功能。

* 使用MAP的数组，每个MAP有如下几种设置选项。缺省值为`[]`。
  * `type`：比较的类型。支持`image`、`html`和`text`。比较HTML时，`html`和`text`都可以使用。前者进行DOM级别的比较、后者进行文本级别的比较。有窗体时、`html`会对主窗体进行比较、需要使用`text`。
  * `content`：比较的对象。支持`html`，`screenshot`和`extra`。
  * `seqs`：有多个比较对象时、可以在特定的比较对象后面加上编号。例如，`[1,3]`是第一和第三个检证物进行比较。不设置时，比较所有检证物。
  * `settings`：传递给比较功能的设定JSON MAP。支持`exclude`。
    * `exclude`（图片比较）：定义比较对象之外的区域的坐标（`x`, `y`, `width`和`height`）。例如，`[[50,50,100,100], [200,200,80,80]]`是从截图的(50,50)开始100x100的区域和(200,200)开始80x80的区域不作为比较对象。
    * `exclude`（HTML比较）：定义比较对象之外的区域的CSS。例如，`["#ads-area", ".popup"]`指定后，所有指定的DOM元素都不作为比较对象。
